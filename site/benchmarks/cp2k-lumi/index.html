
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../howto/cp2k-lumi/">
      
      
        <link rel="next" href="../../reference/mi250x/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.9">
    
    
      
        <title>CP2K on LUMI - Peter Larsson's HPC Notes</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0d440cfe.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Noto Sans";--md-code-font:"IBM Plex Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="red" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cp2k-standard-benchmarks-on-lumi" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Peter Larsson&#39;s HPC Notes" class="md-header__button md-logo" aria-label="Peter Larsson's HPC Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 1h16a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1m0 8h16a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1m0 8h16a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1M9 5h1V3H9v2m0 8h1v-2H9v2m0 8h1v-2H9v2M5 3v2h2V3H5m0 8v2h2v-2H5m0 8v2h2v-2H5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Peter Larsson's HPC Notes
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CP2K on LUMI
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../howto/cp2k-lumi/" class="md-tabs__link">
        How-to guides
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Benchmarks
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../reference/mi250x/" class="md-tabs__link">
        Reference
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Peter Larsson&#39;s HPC Notes" class="md-nav__button md-logo" aria-label="Peter Larsson's HPC Notes" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 1h16a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1m0 8h16a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1m0 8h16a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1v-4a1 1 0 0 1 1-1M9 5h1V3H9v2m0 8h1v-2H9v2m0 8h1v-2H9v2M5 3v2h2V3H5m0 8v2h2v-2H5m0 8v2h2v-2H5Z"/></svg>

    </a>
    Peter Larsson's HPC Notes
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          How-to guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          How-to guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../howto/cp2k-lumi/" class="md-nav__link">
        Compiling CP2K 2023.1 with AMD GPU support
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Benchmarks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Benchmarks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          CP2K on LUMI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        CP2K on LUMI
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preliminary-lumi-g-benchmarks-feb-2023" class="md-nav__link">
    Preliminary LUMI-G benchmarks (Feb. 2023)
  </a>
  
    <nav class="md-nav" aria-label="Preliminary LUMI-G benchmarks (Feb. 2023)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qsh2o-x-standard-dft-molecular-dynamics" class="md-nav__link">
    QS/H2O-x (Standard DFT molecular dynamics)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qs_dm_ls-linear-scaling-dft" class="md-nav__link">
    QS_DM_LS (linear scaling DFT)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qs_mp2_rpa-mp2-and-rpa-calculations" class="md-nav__link">
    QS_mp2_rpa (MP2 and RPA calculations)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lumi-c-benchmarks-from-jan-2022" class="md-nav__link">
    LUMI-C benchmarks from Jan. 2022
  </a>
  
    <nav class="md-nav" aria-label="LUMI-C benchmarks from Jan. 2022">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qs_dm_ls-linear-scaling-dft_1" class="md-nav__link">
    QS_DM_LS Linear scaling DFT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/mi250x/" class="md-nav__link">
        MI250x
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/rocm/" class="md-nav__link">
        ROCm
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preliminary-lumi-g-benchmarks-feb-2023" class="md-nav__link">
    Preliminary LUMI-G benchmarks (Feb. 2023)
  </a>
  
    <nav class="md-nav" aria-label="Preliminary LUMI-G benchmarks (Feb. 2023)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qsh2o-x-standard-dft-molecular-dynamics" class="md-nav__link">
    QS/H2O-x (Standard DFT molecular dynamics)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qs_dm_ls-linear-scaling-dft" class="md-nav__link">
    QS_DM_LS (linear scaling DFT)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qs_mp2_rpa-mp2-and-rpa-calculations" class="md-nav__link">
    QS_mp2_rpa (MP2 and RPA calculations)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#lumi-c-benchmarks-from-jan-2022" class="md-nav__link">
    LUMI-C benchmarks from Jan. 2022
  </a>
  
    <nav class="md-nav" aria-label="LUMI-C benchmarks from Jan. 2022">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qs_dm_ls-linear-scaling-dft_1" class="md-nav__link">
    QS_DM_LS Linear scaling DFT
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="cp2k-standard-benchmarks-on-lumi">CP2K Standard Benchmarks on LUMI</h1>
<p>The <a href="https://www.cp2k.org/">CP2K</a> program contains a set of standard benchmarks, which are distributed with code. You can find them in the <code>benchmarks/</code> directory in the source code folder. On the CP2K, you can find some data for other HPC clusters on the <a href="https://www.cp2k.org/performance">performance page</a>.</p>
<h2 id="preliminary-lumi-g-benchmarks-feb-2023">Preliminary LUMI-G benchmarks (Feb. 2023)</h2>
<p>These were run in the beginning of 2023 with the CP2K 2023.1 release version compiled according to the instructions published in the <a href="/howto/cp2k-lumi">howto section</a>. On LUMI-C, no special core binding was used except what is provided by SLURM using e.g. <code>#SBATCH -c 8</code> for MPI + OpenMP jobs.</p>
<h3 id="qsh2o-x-standard-dft-molecular-dynamics">QS/H2O-x (Standard DFT molecular dynamics)</h3>
<p>These benchmark runs ab initio molecular dynamics (MD) with DFT, on a varying number of water molecules (from 32 to 8192) with TZV2P basis and plane-wave cutoff of 280 Ry. On LUMI-C, </p>
<p><img alt="H2O DFT MD scaling plot" src="/benchmarks/cp2k-qsdft-lumi-feb2023.png" /></p>
<p>The data points are the wall-time taken per MD steps (i.e. one fully converged SCF cycle, typically only a few SCF steps in MD simulations). On LUMI-C, it is possible to run huge cell with a relatively small number of compute nodes. The parallel scaling is decent, but could be better, when comparing to e.g. <a href="https://www.cp2k.org/_media/events:2018_summer_school:cp2k_parallel.pdf]">these benchmarks</a> from Cray XC30 Archer in 2013. It is possible that it related to the network issues seen on LUMI at the start, which still persist.</p>
<p>For smaller jobs (1-4 compute nodes), using 64 MPI ranks per node and <code>OMP_NUM_THREADS=2</code> is the best, but for larger jobs (8+ nodes) running with 32 ranks per node and <code>OMP_NUM_THREADS=8</code> tends to be faster.</p>
<p>But can these be run on GPUs in the LUMI-G partition? The table below compared the time per MD step when running on LUMI-G nodes (8 GPUs/56 cores) vs LUMI-C nodes (128 cores):</p>
<table>
<thead>
<tr>
<th align="left">Benchmark</th>
<th>Nodes</th>
<th align="right">LUMI-C</th>
<th align="right">LUMI-G</th>
<th align="right">Speed-up</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">H2O-256</td>
<td>1</td>
<td align="right">6.6 s</td>
<td align="right">14.2s</td>
<td align="right">0.46x</td>
</tr>
<tr>
<td align="left">H2O-512</td>
<td>4</td>
<td align="right">11.0 s</td>
<td align="right">21.0s</td>
<td align="right">0.52x</td>
</tr>
<tr>
<td align="left">H2O-1024</td>
<td>8</td>
<td align="right">35.2 s</td>
<td align="right">58.5s</td>
<td align="right">0.60x</td>
</tr>
</tbody>
</table>
<p>It turns out the that GPU acceleration on LUMI is not that effective for regular DFT calculations. <strong>The time taken per MD step is almost twice that of LUMI-C node when comparing 1 LUMI-G node vs 1 LUMI-C node</strong>. The results are somewhat disappointing, but a check in the output confirms that many operations are not GPU-accelerated, e.g.</p>
<pre><code>-------------------------------------------------------------------------------
-                                                                             -
-                                DBCSR STATISTICS                             -
-                                                                             -
-------------------------------------------------------------------------------
COUNTER                                    TOTAL       BLAS       SMM       ACC
flops     9 x     9 x    32        3698882869248       0.0%    100.0%      0.0%
flops    32 x    32 x    32        3807488507904       0.0%      0.0%    100.0%
flops    22 x     9 x    32        5135416602624       0.0%    100.0%      0.0%
flops     9 x    22 x    32        5151420223488       0.0%    100.0%      0.0%
flops    22 x    22 x    32        7121164328960       0.0%    100.0%      0.0%
flops    32 x    32 x     9       10427106852864       0.0%    100.0%      0.0%
flops    32 x    32 x    22       12744241709056       0.0%    100.0%      0.0%
flops     9 x    32 x    32       12749107101696       0.0%    100.0%      0.0%
flops    22 x    32 x    32       15582242013184       0.0%    100.0%      0.0%
flops     9 x    32 x     9       30219541585920       0.0%    100.0%      0.0%
flops    22 x    32 x     9       39766190137344       0.0%    100.0%      0.0%
flops     9 x    32 x    22       39766190137344       0.0%    100.0%      0.0%
flops    22 x    32 x    22       52085304426496       0.0%    100.0%      0.0%
flops inhomo. stacks                           0       0.0%      0.0%      0.0%
flops total                       238.254296E+12       0.0%     98.4%      1.6%
flops max/rank                     29.798089E+12       0.0%     98.4%      1.6%
matmuls inhomo. stacks                         0       0.0%      0.0%      0.0%
matmuls total                        17486460992       0.0%     99.7%      0.3%
number of processed stacks               2865104       0.0%     86.1%     13.9%
average stack size                                     0.0    7061.9     146.3
marketing flops                   375.300685E+12
-------------------------------------------------------------------------------
</code></pre>
<p>Only a subset of operations (32x32x32) are running on the GPU (100% in the <code>ACC</code> column). It then makes sense that the runtime is doubled with half the number of CPU core per node.</p>
<h3 id="qs_dm_ls-linear-scaling-dft">QS_DM_LS (linear scaling DFT)</h3>
<p>What about linear scaling DFT? Does it work better on the GPU nodes. Using the previous benchmarks (see below) as a baseline, I get the following using 8 MPI ranks/8 GPUs per LUMI-G node and <code>OMP_NUM_THREADS=7</code> to account for only 63 available cores.</p>
<table>
<thead>
<tr>
<th align="right">Nodes</th>
<th align="right">LUMI-C</th>
<th align="right">LUMI-G</th>
<th align="right">Speed-up</th>
</tr>
</thead>
<tbody>
<tr>
<td align="right">4</td>
<td align="right">723 s</td>
<td align="right">436 s</td>
<td align="right">1.65x</td>
</tr>
<tr>
<td align="right">8</td>
<td align="right">462 s</td>
<td align="right">278 s</td>
<td align="right">1.65x</td>
</tr>
</tbody>
</table>
<p>In this case, there is some speed-up, even if it is not dramatic. The ratio of GPU-node to CPU-node speed seems to be somewhat better (1.6x vs 1.3x) compared to what was observed on Piz Daint with GPU acceleration (<a href="https://www.cp2k.org/performance:piz-daint-h2o-dft-ls">this page</a>). The output file confirms much more GPU usage, for example in the DBCSR library:</p>
<pre><code>-------------------------------------------------------------------------------
-                                                                             -
-                                DBCSR STATISTICS                             -
-                                                                             -
-------------------------------------------------------------------------------
COUNTER                                    TOTAL       BLAS       SMM       ACC
flops    23 x    23 x    23     2229574562881438       0.0%      0.0%    100.0%
flops inhomo. stacks                           0       0.0%      0.0%      0.0%
flops total                         2.229575E+15       0.0%      0.0%    100.0%
flops max/rank                     79.250686E+12       0.0%      0.0%    100.0%
matmuls inhomo. stacks                         0       0.0%      0.0%      0.0%
matmuls total                        91623841657       0.0%      0.0%    100.0%
number of processed stacks               3127188       0.0%      0.0%    100.0%
average stack size                                     0.0       0.0   29299.1
marketing flops                   891.964171E+15
-------------------------------------------------------------------------------
</code></pre>
<p><strong>It is doubtful, though, if it makes economic sense to run these kind of calculations on LUMI-G</strong>, as you would typically need to see a speed-up of at least 3x to 4x for it to make sense.</p>
<p>An interesting find is that activating huge memory pages (2 MB) significantly speeds up the GPU version of the code (but not so much the CPU-only version). For example, the original timing for the 4 LUMI-G node run was ca 540 s without huge pages, compared to 436 s when the binary is linked with the <code>craype-hugepages2M</code> module. It is about 25% faster. Increasing the huge page size further to 8 MB did not result in any more improvement.</p>
<h3 id="qs_mp2_rpa-mp2-and-rpa-calculations">QS_mp2_rpa (MP2 and RPA calculations)</h3>
<p>Next up! These should be faster on GPUs...</p>
<h2 id="lumi-c-benchmarks-from-jan-2022">LUMI-C benchmarks from Jan. 2022</h2>
<p>These were run on LUMI-C during 2022 with CP2K 9.1 built from the LUMI EasyBuild recipes.</p>
<h3 id="qs_dm_ls-linear-scaling-dft_1">QS_DM_LS Linear scaling DFT</h3>
<p>This benchmark using the linear scaling DFT method in CP2K and simulates 6912 water molecules (21k atoms) with DZVP basis and 300 Ry cut-off. It runs for 2 SCF iterations (which is not enough to achieve convergence).</p>
<p>I was able to ran some benchmarks with many nodes on LUMI-C during Jan 2022 with CP2K 9.1 and no extensive tuning other testing different values of <code>OMP_NUM_THREADS</code>, but the results were not impressive compared to what was published before for e.g. the Piz Daint and Noctua clusters <a href="https://www.cp2k.org/performance">on the CP2K web page</a>:</p>
<p><img alt="H2O LS-DFT scaling plot" src="/benchmarks/cp2k-lsdft-lumi-jan2022.png" /></p>
<p>I was not able to scale out sufficiently to beat the fastest time to solution as run previously on e.g. the Piz Daint (the year 2015 configuration with Cray XC30 with Intel Xeon Sandy Bridge and 1 Nvidia Tesla GPU K20X per node?) and the Noctua clusters (Intel Xeon Skylake with 100 Gbit/s Omni-Path network). It seems to primarily be a network/scaling problem as the speed on low core counts (256-512) is still ok.</p>
<p>Running with 16 MPI ranks per compute node with 8 OpenMP threads (<code>OMP_NUM_THREADS=8</code>) was generally the fastest. I advise to always use at least <code>OMP_NUM_THREADS=2</code> when running on LUMI-C, as empirically, loading 128 MPI ranks per node increases the risk of running into various network problems.</p>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.top", "navigation.instant", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a00a7c5e.min.js"></script>
      
    
  </body>
</html>